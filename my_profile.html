<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile - CULTURALLM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- INCLUSIONE CROPPER.JS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
    <style>
        /* Stili Personalizzati */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #000000;
        }
        .gradient-text {
            background: linear-gradient(to right, #d8b4fe, #7c3aed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .tab-active {
            color: #F3F4F6; /* neutral-dark-100 */
            border-bottom: 2px solid #A855F7; /* brand-purple-light */
        }
        .tab-inactive {
            color: #A0A0A0; /* neutral-dark-400 */
            border-bottom: 2px solid transparent;
        }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #1C1C1E; }
        ::-webkit-scrollbar-thumb { background: #3A3A3C; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #A855F7; }

        /* Stili per il cropper e il suo contenitore */
        .cropper-container-modal {
            max-height: 70vh;
        }
        .cropper-bg {
            background: rgba(0,0,0,0.7);
        }
        .cropper-view-box,
        .cropper-face {
          border-radius: 50%;
        }
    </style>
    <script>
        // Configurazione di Tailwind CSS
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand-purple': {
                            light: '#A855F7',
                            DEFAULT: '#9333EA',
                            dark: '#7E22CE'
                        },
                        'neutral-dark': {
                            950: '#0F0F0F',
                            900: '#1C1C1E',
                            800: '#2C2C2E',
                            700: '#3A3A3C',
                            400: '#A0A0A0',
                            300: '#D1D5DB',
                            200: '#E5E7EB',
                            100: '#F3F4F6'
                        },
                        'brand-purple-deep': '#28193a'
                    },
                    maxWidth: {
                        'screen-2xl': '1536px',
                    }
                }
            }
        }
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
</head>

<body class="text-neutral-dark-300 selection:bg-brand-purple selection:text-white">

    <!-- Navbar -->
    <header class="sticky top-0 z-50 bg-black backdrop-blur-md border-b border-neutral-dark-800">
        <div class="w-full max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex-shrink-0">
                    <a href="#" class="text-2xl font-extrabold gradient-text">CULTURALLM</a>
                </div>
                <div class="flex-1 px-4 lg:px-12">
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <ion-icon name="search-outline" class="text-neutral-dark-400"></ion-icon>
                        </div>
                        <input type="search" name="search" id="search"
                            class="block w-full pl-10 pr-3 py-2.5 bg-neutral-dark-900 border border-neutral-dark-800 rounded-lg
                                    text-neutral-dark-300 placeholder-neutral-dark-400 focus:outline-none
                                    focus:ring-1 focus:ring-brand-purple focus:border-brand-purple sm:text-sm"
                            placeholder="Search questions, topics, cultures...">
                    </div>
                </div>

                <!--{/* Icone a destra per schermi grandi */}-->
                <div class="hidden lg:flex items-center space-x-3 sm:space-x-4">
                    <button title="Create a Question" class="p-1.5 rounded-full text-white hover:text-brand-purple-light hover:bg-neutral-dark-800 transition-colors hover:rounded-md">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
                    </button>
                    <button title="Question Dashboard" class="p-1.5 rounded-full text-white hover:text-brand-purple-light hover:bg-neutral-dark-800 transition-colors hover:rounded-md">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v16a2 2 0 0 0 2 2h16"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/></svg>
                    </button>
                    <button title="Profile" class="p-1.5 rounded-full text-white hover:text-brand-purple-light hover:bg-neutral-dark-800 transition-colors hover:rounded-md">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                    </button>
                    <button title="Settings" class="p-1.5 rounded-full text-white hover:text-brand-purple-light hover:bg-neutral-dark-800 transition-colors hover:rounded-md">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
                    </button>
                    <button title="Mission & Challenge" class="p-1.5 rounded-full text-white hover:text-brand-purple-light hover:bg-neutral-dark-800 transition-colors hover:rounded-md">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978"/><path d="M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978"/><path d="M18 9h1.5a1 1 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z"/><path d="M6 9H4.5a1 1 0 0 1 0-5H6"/></svg>
                    </button>
                    <button title="Notifications" class="p-1.5 rounded-full text-white hover:text-brand-purple-light hover:bg-neutral-dark-800 transition-colors hover:rounded-md relative">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.268 21a2 2 0 0 0 3.464 0"/><path d="M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326"/></svg>
                        <!-- <span class="absolute top-0.5 right-0.5 block h-2 w-2 rounded-full ring-2 ring-black bg-red-500"></span> Esempio notifica -->
                    </button>
                    <button title="Shop" class="p-1.5 rounded-full text-white hover:text-brand-purple-light hover:bg-neutral-dark-800 transition-colors hover:rounded-md">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 10a4 4 0 0 1-8 0"/><path d="M3.103 6.034h17.794"/><path d="M3.4 5.467a2 2 0 0 0-.4 1.2V20a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6.667a2 2 0 0 0-.4-1.2l-2-2.667A2 2 0 0 0 17 2H7a2 2 0 0 0-1.6.8z"/></svg>
                    </button>
                    <button title="Message" class="p-1.5 rounded-full text-white hover:text-brand-purple-light hover:bg-neutral-dark-800 transition-colors hover:rounded-md">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"/></svg>
                    </button>
                    <div class="w-px h-6 bg-gray-500 opacity-50"></div>
                    <button title="Log-out" class="p-1.5 rounded-full text-red-500 hover:text-white hover:bg-neutral-dark-800 transition-colors hover:rounded-md">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m16 17 5-5-5-5"/><path d="M21 12H9"/><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/></svg>
                    </button>
                </div>

                <!--{/* Pulsante Hamburger per schermi piccoli e Menu Dropdown */}-->
                <div class="lg:hidden flex items-center">
                    <button id="mobileMenuButton" class="p-2 rounded-md text-white hover:text-brand-purple-light hover:bg-neutral-dark-800 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-brand-purple-light">
                        <span class="sr-only">Open main menu</span>
                        <ion-icon name="menu-outline" id="menuIconOpen" class="block h-6 w-6"></ion-icon>
                        <ion-icon name="close-outline" id="menuIconClose" class="hidden h-6 w-6"></ion-icon>
                    </button>
                </div>
            </div>

            <!--{/* Menu Dropdown Mobile - inizialmente nascosto */}-->
            <div id="mobileMenu" class="hidden lg:hidden absolute right-4 mt-2 w-56 origin-top-right bg-neutral-dark-900 border border-neutral-dark-800 rounded-md shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none" role="menu" aria-orientation="vertical" aria-labelledby="mobileMenuButton" tabindex="-1">
                <div class="py-1" role="none">
                    <a href="#" title="Create a Question" class="flex items-center px-4 py-2 text-sm text-neutral-dark-200 hover:bg-neutral-dark-800 hover:text-brand-purple-light" role="menuitem" tabindex="-1">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
                        Create
                    </a>
                    <a href="#" title="Question Dashboard" class="flex items-center px-4 py-2 text-sm text-neutral-dark-200 hover:bg-neutral-dark-800 hover:text-brand-purple-light" role="menuitem" tabindex="-1">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v16a2 2 0 0 0 2 2h16"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/></svg>
                        Dashboard
                    </a>
                    <a href="#" title="Profile" class="flex items-center px-4 py-2 text-sm text-neutral-dark-200 hover:bg-neutral-dark-800 hover:text-brand-purple-light" role="menuitem" tabindex="-1">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                        Profile
                    </a>
                    <a href="#" title="Settings" class="flex items-center px-4 py-2 text-sm text-neutral-dark-200 hover:bg-neutral-dark-800 hover:text-brand-purple-light" role="menuitem" tabindex="-1">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
                        Settings
                    </a>
                    <a href="#" title="Mission & Challenge" class="flex items-center px-4 py-2 text-sm text-neutral-dark-200 hover:bg-neutral-dark-800 hover:text-brand-purple-light" role="menuitem" tabindex="-1">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978"/><path d="M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978"/><path d="M18 9h1.5a1 1 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z"/><path d="M6 9H4.5a1 1 0 0 1 0-5H6"/></svg>
                        Missions
                    </a>
                    <a href="#" title="Notifications" class="flex items-center px-4 py-2 text-sm text-neutral-dark-200 hover:bg-neutral-dark-800 hover:text-brand-purple-light relative" role="menuitem" tabindex="-1">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.268 21a2 2 0 0 0 3.464 0"/><path d="M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326"/></svg>
                        Notifications
                        <!-- <span class="absolute top-1.5 right-3 block h-2 w-2 rounded-full bg-red-500"></span> Esempio notifica nel menu -->
                    </a>
                    <a href="#" title="Shop" class="flex items-center px-4 py-2 text-sm text-neutral-dark-200 hover:bg-neutral-dark-800 hover:text-brand-purple-light" role="menuitem" tabindex="-1">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 10a4 4 0 0 1-8 0"/><path d="M3.103 6.034h17.794"/><path d="M3.4 5.467a2 2 0 0 0-.4 1.2V20a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6.667a2 2 0 0 0-.4-1.2l-2-2.667A2 2 0 0 0 17 2H7a2 2 0 0 0-1.6.8z"/></svg>
                        Shop
                    </a>
                    <a href="#" title="Message" class="flex items-center px-4 py-2 text-sm text-neutral-dark-200 hover:bg-neutral-dark-800 hover:text-brand-purple-light" role="menuitem" tabindex="-1">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"/></svg>
                        Messages
                    </a>
                    <div class="border-t border-neutral-dark-700 mx-2 my-1"></div>
                    <a href="#" title="Log-out" class="flex items-center px-4 py-2 text-sm text-red-500 hover:bg-neutral-dark-800 hover:text-red-400" role="menuitem" tabindex="-1">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m16 17 5-5-5-5"/><path d="M21 12H9"/><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/></svg>
                        Log-out
                    </a>
                </div>
            </div>
        </div>
    </header>

    <main class="w-full max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- VISTA PROFILO -->
        <div id="profile-view">
            <div class="relative">
                <div class="h-48 md:h-64 rounded-xl bg-brand-purple-deep"></div>
                <div class="absolute -bottom-16 left-8 md:left-12">
                    <img id="profile-pic-display" src="default-avatar-circle.jpg" alt="Profile Picture" class="h-32 w-32 md:h-40 md:w-40 rounded-full border-4 border-black object-cover bg-neutral-dark-800">
                </div>
                 <button id="edit-profile-btn" class="absolute top-4 right-4 bg-neutral-dark-900/50 backdrop-blur-sm border border-neutral-dark-800 text-neutral-dark-300 hover:text-white hover:bg-neutral-dark-800 px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-all">
                    <ion-icon name="settings-outline"></ion-icon>
                    <span>Edit Profile</span>
                </button>
            </div>

            <div class="mt-20 px-4 md:px-12">
                <h1 id="profile-name-display" class="text-3xl md:text-4xl font-bold text-neutral-dark-100">

                </h1>
                <p id="profile-username-display" class="text-neutral-dark-400">

                </p>
                <p id="profile-bio-display" class="mt-4 max-w-3xl text-neutral-dark-300">

                </p>
                <div class="mt-4 flex flex-wrap items-center gap-x-6 gap-y-2 text-sm text-neutral-dark-400">
                    <div id="profile-location-display" class="flex items-center gap-2">
                        <ion-icon name="location-outline"></ion-icon>
                        <span></span>
                    </div>
                    <div id="profile-birthdate-display" class="flex items-center gap-2">
                        <ion-icon name="calendar-outline"></ion-icon>
                        <span> </span>
                    </div>
                    <div id="profile-joined-display" class="flex items-center gap-2">
                        <ion-icon name="time-outline"></ion-icon>
                        <span>20 July 2025</span>
                    </div>
                    <div id="profile-website-display" class="flex items-center gap-2">
                        <ion-icon name="globe-outline"></ion-icon>
                        <a href="#" class="hover:text-brand-purple-light"></a>
                    </div>
                </div>
            </div>

            <!-- Statistiche -->
            <div class="mt-8 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 gap-4">
                <div class="bg-neutral-dark-950 border border-neutral-dark-800 rounded-xl p-4 flex flex-col items-center justify-center text-center">
                    <ion-icon name="chatbox-ellipses-outline" class="text-2xl text-brand-purple-light mb-2"></ion-icon>
                    <p class="text-2xl font-bold text-white">127</p>
                    <p class="text-sm text-neutral-dark-400">Questions Asked</p>
                </div>
                <div class="bg-neutral-dark-950 border border-neutral-dark-800 rounded-xl p-4 flex flex-col items-center justify-center text-center">
                    <ion-icon name="pencil-outline" class="text-2xl text-brand-purple-light mb-2"></ion-icon>
                    <p class="text-2xl font-bold text-white">89</p>
                    <p class="text-sm text-neutral-dark-400">Answers Given</p>
                </div>
                <div class="bg-neutral-dark-950 border border-neutral-dark-800 rounded-xl p-4 flex flex-col items-center justify-center text-center">
                    <ion-icon name="trophy-outline" class="text-2xl text-yellow-400 mb-2"></ion-icon>
                    <p class="text-2xl font-bold text-white">#12</p>
                    <p class="text-sm text-neutral-dark-400">Leaderboard Rank</p>
                </div>

                <div class="bg-neutral-dark-950 border border-neutral-dark-800 rounded-xl p-4 flex flex-col items-center justify-center text-center">
                    <ion-icon name="ribbon-outline" class="text-2xl text-brand-purple-light mb-2"></ion-icon>
                    <p class="text-2xl font-bold text-white">23</p>
                    <p class="text-sm text-neutral-dark-400">Missions Completed</p>
                </div>
                <div class="bg-neutral-dark-950 border border-neutral-dark-800 rounded-xl p-4 flex flex-col items-center justify-center text-center">
                    <ion-icon name="trophy-outline" class="text-2xl text-brand-purple-light mb-2"></ion-icon>
                    <p class="text-2xl font-bold text-white">2,847</p>
                    <p class="text-sm text-neutral-dark-400">Points Earned</p>
                </div>
                 <div class="bg-neutral-dark-950 border border-neutral-dark-800 rounded-xl p-4 flex flex-col items-center justify-center text-center">
                    <ion-icon name="cash-outline" class="text-2xl text-yellow-400 mb-2"></ion-icon>
                    <p class="text-2xl font-bold text-white">156</p>
                    <p class="text-sm text-neutral-dark-400">Coins Earned</p>
                </div>
            </div>

            <!-- Navigazione a Schede -->
            <div class="mt-8 border-b border-neutral-dark-800">
                <!-- Usa Grid invece di Flex -->
                <nav class="grid grid-cols-4" aria-label="Tabs">
                    <!-- Aggiungi text-center a ogni pulsante per allineare il testo -->
                    <button data-tab="activity-content" class="tab-btn py-4 px-1 text-sm font-medium tab-active text-center">Activity</button>
                    <button data-tab="questions-content" class="tab-btn py-4 px-1 text-sm font-medium tab-inactive hover:text-white transition-colors text-center">Questions</button>
                    <button data-tab="answers-content" class="tab-btn py-4 px-1 text-sm font-medium tab-inactive hover:text-white transition-colors text-center">Answers</button>
                    <button data-tab="achievements-content" class="tab-btn py-4 px-1 text-sm font-medium tab-inactive hover:text-white transition-colors text-center">Achievements</button>
                </nav>
            </div>
            
            <!-- Contenuto delle Schede -->
            <div class="mt-6">
                <!-- Contenuto Attività (Visibile di default) -->
                <div id="activity-content" class="tab-content space-y-4">
                     <h2 class="text-xl font-semibold text-neutral-dark-100 mb-4">Recent Activity</h2>
                     <div class="p-4 bg-neutral-dark-950 border border-neutral-dark-800 rounded-lg">
                        <p class="text-neutral-dark-200">Asked about <span class="font-semibold text-brand-purple-light">Japanese tea ceremony traditions</span></p>
                        <div class="flex justify-between items-center mt-2 text-sm text-neutral-dark-400">
                            <span>2 hours ago</span>
                        </div>
                     </div>
                     <div class="p-4 bg-neutral-dark-950 border border-neutral-dark-800 rounded-lg">
                        <p class="text-neutral-dark-200">Answered <span class="font-semibold text-brand-purple-light">'Mexican Day of the Dead celebrations'</span></p>
                        <div class="flex justify-between items-center mt-2 text-sm text-neutral-dark-400">
                            <span>1 day ago</span>
                        </div>
                     </div>
                     <div class="p-4 bg-neutral-dark-950 border border-neutral-dark-800 rounded-lg">
                        <p class="text-neutral-dark-200">Completed <span class="font-semibold text-brand-purple-light">'Cultural Recipe Challenge'</span></p>
                        <div class="flex justify-between items-center mt-2 text-sm text-neutral-dark-400">
                            <span>3 days ago</span>
                            <span class="text-yellow-400">Mission Completed</span>
                        </div>
                     </div>
                </div>

                <!-- Contenuto Domande (Nascosto) -->
                <div id="questions-content" class="tab-content hidden">
                    <h2 class="text-xl font-semibold text-neutral-dark-100 mb-4">Questions Asked (127)</h2>
                    
                    <div id="questions-list" class="space-y-4">
                        
                        <!-- Domanda 1 -->
                        <div class="p-4 bg-neutral-dark-950 border border-neutral-dark-800 rounded-lg flex flex-col sm:flex-row justify-between sm:items-center gap-3">
                            <div class="flex-1 min-w-0">
                                <a href="#" class="block font-semibold text-neutral-dark-100 hover:text-brand-purple-light transition-colors truncate">What are the main etiquette rules for a Japanese tea ceremony?</a>
                                <div class="flex items-center text-sm text-neutral-dark-400 mt-1 space-x-3">
                                    <span>1 day ago</span>
                                    <span class="text-neutral-dark-700">|</span>
                                    <div class="flex items-center gap-1.5">
                                        <span class="inline-block w-2 h-2 rounded-full bg-green-400"></span>
                                        <span>Active</span>
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center gap-4 text-sm text-neutral-dark-300 flex-shrink-0">
                                <span class="flex items-center gap-1.5"><ion-icon name="arrow-up-outline"></ion-icon> 12</span>
                                <span class="flex items-center gap-1.5"><ion-icon name="arrow-down-outline"></ion-icon> 16</span>
                                <span class="flex items-center gap-1.5"><ion-icon name="chatbox-ellipses-outline"></ion-icon> 4</span>
                            </div>
                        </div>

                        <!-- Domanda 2 -->
                        <div class="p-4 bg-neutral-dark-950 border border-neutral-dark-800 rounded-lg flex flex-col sm:flex-row justify-between sm:items-center gap-3">
                            <div class="flex-1 min-w-0">
                                <a href="#" class="block font-semibold text-neutral-dark-100 hover:text-brand-purple-light transition-colors truncate">Differences between Carnival in Rio de Janeiro and Venice?</a>
                                <div class="flex items-center text-sm text-neutral-dark-400 mt-1 space-x-3">
                                    <span>5 days ago</span>
                                    <span class="text-neutral-dark-700">|</span>
                                    <div class="flex items-center gap-1.5">
                                        <span class="inline-block w-2 h-2 rounded-full bg-green-400"></span>
                                        <span>Active</span>
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center gap-4 text-sm text-neutral-dark-300 flex-shrink-0">
                                <span class="flex items-center gap-1.5"><ion-icon name="arrow-up-outline"></ion-icon> 98</span>
                                <span class="flex items-center gap-1.5"><ion-icon name="arrow-down-outline"></ion-icon> 65</span>
                                <span class="flex items-center gap-1.5"><ion-icon name="chatbox-ellipses-outline"></ion-icon> 11</span>
                            </div>
                        </div>

                        <!-- Domanda 3 -->
                        <div class="p-4 bg-neutral-dark-950 border border-neutral-dark-800 rounded-lg flex flex-col sm:flex-row justify-between sm:items-center gap-3">
                            <div class="flex-1 min-w-0">
                                <a href="#" class="block font-semibold text-neutral-dark-100 hover:text-brand-purple-light transition-colors truncate">Can someone explain the significance of Dia de los Muertos altars?</a>
                                <div class="flex items-center text-sm text-neutral-dark-400 mt-1 space-x-3">
                                    <span>2 weeks ago</span>
                                    <span class="text-neutral-dark-700">|</span>
                                    <div class="flex items-center gap-1.5">
                                        <span class="inline-block w-2 h-2 rounded-full bg-yellow-400"></span>
                                        <span>Ranking</span>
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center gap-4 text-sm text-neutral-dark-300 flex-shrink-0">
                                <span class="flex items-center gap-1.5"><ion-icon name="arrow-up-outline"></ion-icon> 2</span>
                                <span class="flex items-center gap-1.5"><ion-icon name="arrow-down-outline"></ion-icon> 5</span>
                                <span class="flex items-center gap-1.5"><ion-icon name="chatbox-ellipses-outline"></ion-icon> 21</span>
                            </div>
                        </div>

                        <!-- Domanda 4 -->
                        <div class="p-4 bg-neutral-dark-950 border border-neutral-dark-800 rounded-lg flex flex-col sm:flex-row justify-between sm:items-center gap-3">
                            <div class="flex-1 min-w-0">
                                <a href="#" class="block font-semibold text-neutral-dark-100 hover:text-brand-purple-light transition-colors truncate">Traditional clothing in Scotland: more than just kilts?</a>
                                <div class="flex items-center text-sm text-neutral-dark-400 mt-1 space-x-3">
                                    <span>1 month ago</span>
                                    <span class="text-neutral-dark-700">|</span>
                                    <div class="flex items-center gap-1.5">
                                        <span class="inline-block w-2 h-2 rounded-full bg-red-400"></span>
                                        <span>Closed</span>
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center gap-4 text-sm text-neutral-dark-300 flex-shrink-0">
                                <span class="flex items-center gap-1.5"><ion-icon name="arrow-up-outline"></ion-icon> 3</span>
                                <span class="flex items-center gap-1.5"><ion-icon name="arrow-down-outline"></ion-icon> 23</span>
                                <span class="flex items-center gap-1.5"><ion-icon name="chatbox-ellipses-outline"></ion-icon> 7</span>
                            </div>
                        </div>

                    </div>

                    <!-- Pulsante Load More (solo visivo) -->
                    <div class="mt-8 text-center">
                        <button class="bg-neutral-dark-800 hover:bg-neutral-dark-700 text-neutral-dark-200 font-semibold py-2.5 px-6 rounded-lg transition-colors">
                            Load More Questions
                        </button>
                    </div>
                </div>

                <!-- Contenuto Risposte (Nascosto) -->
                <div id="answers-content" class="tab-content hidden">
                    <h2 class="text-xl font-semibold text-neutral-dark-100 mb-4">Answers Given (89)</h2>
                    
                    <div id="answers-list" class="space-y-4">
                        
                        <!-- Risposta 1 -->
                        <div class="p-4 bg-neutral-dark-950 border border-neutral-dark-800 rounded-lg">
                            <div class="flex items-center text-sm text-neutral-dark-400">
                                <span class="flex-shrink-0 mr-1.5">Answered to</span>
                                <a href="#" class="font-semibold text-brand-purple-light hover:underline truncate">
                                    What are the complex socio-economic implications of traditional clothing in a modern globalized context?
                                </a>
                            </div>
                            
                            <p class="mt-2 text-neutral-dark-200 line-clamp-2">
                                The altars, or "ofrendas", are not for worshipping but for welcoming the spirits back to the realm of the living. They are loaded with offerings of food, beverages, and personal items to honor the deceased. The vibrant marigold flowers, or cempasúchil, are believed to guide the spirits to their altars with their bright colors and strong scent.
                            </p>

                            <div class="flex justify-between items-center mt-3 text-sm text-neutral-dark-400">
                                <span>1 day ago</span>
                            </div>
                        </div>

                        <!-- Risposta 2 -->
                        <div class="p-4 bg-neutral-dark-950 border border-neutral-dark-800 rounded-lg">
                            <div class="flex items-center text-sm text-neutral-dark-400">
                                <span class="flex-shrink-0 mr-1.5">Answered to</span>
                                <a href="#" class="font-semibold text-brand-purple-light hover:underline truncate">What is haggis made of?</a>
                            </div>
                            <p class="mt-2 text-neutral-dark-200 line-clamp-2">
                                It's a savoury pudding containing sheep's pluck (heart, liver, and lungs); minced with onion, oatmeal, suet, spices, and stock, traditionally encased in the animal's stomach. While it might not sound appealing to everyone, it has a rich, peppery flavor that is a staple of Scottish cuisine, especially during Burns Night.
                            </p>
                            <div class="flex justify-between items-center mt-3 text-sm text-neutral-dark-400">
                                <span>6 days ago</span>
                            </div>
                        </div>


                        <!-- Risposta 3 -->
                        <div class="p-4 bg-neutral-dark-950 border border-neutral-dark-800 rounded-lg">
                            <div class="flex items-center text-sm text-neutral-dark-400">
                                <span class="flex-shrink-0 mr-1.5">Answered to</span>
                                <a href="#" class="font-semibold text-brand-purple-light hover:underline truncate">Symbolism of colors in traditional Indian weddings?</a>
                            </div>
                            <p class="mt-2 text-neutral-dark-200 line-clamp-2">
                                Red is the most prominent color, symbolizing love, passion, and prosperity. Saffron is also sacred. The bride often wears a red or pink lehenga for the main ceremony.
                            </p>
                            <div class="flex justify-between items-center mt-3 text-sm text-neutral-dark-400">
                                <span>3 weeks ago</span>
                            </div>
                        </div>

                        <!-- Risposta 4 -->
                        <div class="p-4 bg-neutral-dark-950 border border-neutral-dark-800 rounded-lg">
                            <div class="flex items-center text-sm text-neutral-dark-400">
                                <span class="flex-shrink-0 mr-1.5">Answered to</span>
                                <a href="#" class="font-semibold text-brand-purple-light hover:underline truncate">How to properly greet someone in South Korea?</a>
                            </div>
                            <p class="mt-2 text-neutral-dark-200 line-clamp-2">
                                A bow is the traditional way to greet. The depth of the bow depends on the age and seniority of the person you are greeting. It's respectful to support your right arm with your left hand when shaking hands or bowing to someone of higher status.
                            </p>
                            <div class="flex justify-between items-center mt-3 text-sm text-neutral-dark-400">
                                <span>1 month ago</span>
                            </div>
                        </div>

                    </div>

                    <div class="mt-8 text-center">
                        <button class="bg-neutral-dark-800 hover:bg-neutral-dark-700 text-neutral-dark-200 font-semibold py-2.5 px-6 rounded-lg transition-colors">
                            Load More Answers
                        </button>
                    </div>
                </div>

                <!-- Contenuto Achievements (Nascosto) -->
                <div id="achievements-content" class="tab-content hidden">
                    <h2 class="text-xl font-semibold text-neutral-dark-100 mb-4">Badges & Achievements</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div class="bg-neutral-dark-900 border border-neutral-dark-800 rounded-lg p-4 flex items-center gap-4">
                            <div class="flex-shrink-0 h-12 w-12 rounded-full bg-blue-500/20 flex items-center justify-center"><ion-icon name="earth-outline" class="text-2xl text-blue-400"></ion-icon></div>
                            <div>
                                <h3 class="font-semibold text-white">Cultural Explorer</h3>
                                <p class="text-sm text-neutral-dark-400">Asked 100+ questions</p>
                            </div>
                        </div>
                        <div class="bg-neutral-dark-900 border border-neutral-dark-800 rounded-lg p-4 flex items-center gap-4">
                            <div class="flex-shrink-0 h-12 w-12 rounded-full bg-green-500/20 flex items-center justify-center"><ion-icon name="sparkles-outline" class="text-2xl text-green-400"></ion-icon></div>
                            <div>
                                <h3 class="font-semibold text-white">Helpful Contributor</h3>
                                <p class="text-sm text-neutral-dark-400">50+ helpful answers</p>
                            </div>
                        </div>
                        <div class="bg-neutral-dark-900 border border-neutral-dark-800 rounded-lg p-4 flex items-center gap-4">
                            <div class="flex-shrink-0 h-12 w-12 rounded-full bg-purple-500/20 flex items-center justify-center"><ion-icon name="people-outline" class="text-2xl text-purple-400"></ion-icon></div>
                            <div>
                                <h3 class="font-semibold text-white">Community Leader</h3>
                                <p class="text-sm text-neutral-dark-400">Make it to the top 100</p>
                            </div>
                        </div>
                        <div class="bg-neutral-dark-900 border border-neutral-dark-800 rounded-lg p-4 flex items-center gap-4">
                            <div class="flex-shrink-0 h-12 w-12 rounded-full bg-orange-500/20 flex items-center justify-center"><ion-icon name="ribbon-outline" class="text-2xl text-orange-400"></ion-icon></div>
                            <div>
                                <h3 class="font-semibold text-white">Mission Master</h3>
                                <p class="text-sm text-neutral-dark-400">Completed 20 missions</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- VISTA MODIFICA PROFILO -->
        <div id="edit-profile-view" class="hidden">
            <button id="back-to-profile-btn" class="mb-6 text-sm text-neutral-dark-400 hover:text-white flex items-center gap-2">
                <ion-icon name="arrow-back-outline"></ion-icon> Back to Profile
            </button>
            <h1 class="text-3xl font-bold text-white mb-8">Edit Profile</h1>

            <form id="edit-profile-form" class="space-y-12">
                 <div class="bg-neutral-dark-950 border border-neutral-dark-800 rounded-xl p-6">
                    <h2 class="text-lg font-semibold text-neutral-dark-100">Profile Picture</h2>
                    <p class="text-sm text-neutral-dark-400 mb-4">Update your profile picture</p>
                    <div class="flex flex-wrap items-center gap-4">
                        <img id="profile-pic-edit-preview" src="default-avatar-circle.jpg" alt="Profile preview" class="h-24 w-24 rounded-full object-cover bg-neutral-dark-800">
                        <div class="flex flex-col sm:flex-row gap-3">
                            <label for="profile-picture-upload" class="cursor-pointer bg-neutral-dark-800 hover:bg-neutral-dark-700 text-neutral-dark-200 font-medium py-2 px-4 rounded-lg transition-colors flex items-center justify-center gap-2">
                                <ion-icon name="cloud-upload-outline"></ion-icon> Upload New Picture
                            </label>
                            <button type="button" id="revert-default-pic-btn" class="bg-neutral-dark-800 hover:bg-neutral-dark-700 text-neutral-dark-300 font-medium py-2 px-4 rounded-lg transition-colors flex items-center justify-center gap-2">
                                <ion-icon name="refresh-outline"></ion-icon> Revert to Default
                            </button>
                        </div>
                        <input type="file" id="profile-picture-upload" name="profile_picture" class="hidden" accept="image/*">
                    </div>
                 </div>

                 <!-- Campi del modulo... -->
                 <div class="bg-neutral-dark-950 border border-neutral-dark-800 rounded-xl p-6">
                    <h2 class="text-lg font-semibold text-neutral-dark-100">Basic Information</h2>
                    <p class="text-sm text-neutral-dark-400 mb-6">Update your basic profile information</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div> 
                            <label for="first-name" class="block text-sm font-medium text-neutral-dark-300 mb-1">First Name <span class="text-red-500 ml-1">*</span></label> 
                            <input value="Davide" required type="text" id="first-name" class="w-full bg-neutral-dark-900 border border-neutral-dark-700 rounded-lg p-2.5 focus:outline-none focus:ring-2 focus:ring-brand-purple-light focus:border-brand-purple-light"> 
                        </div>
                        <div> 
                            <label for="last-name" class="block text-sm font-medium text-neutral-dark-300 mb-1">Last Name <span class="text-red-500 ml-1">*</span></label> 
                            <input value="Ottaviani" required type="text" id="last-name" class="w-full bg-neutral-dark-900 border border-neutral-dark-700 rounded-lg p-2.5 focus:outline-none focus:ring-2 focus:ring-brand-purple-light focus:border-brand-purple-light"> 
                        </div>
                        <div class="md:col-span-2"> 
                            <label for="username" class="block text-sm font-medium text-neutral-dark-300 mb-1">Username <span class="text-red-500 ml-1">*</span></label> 
                            <input value="ottavianidavide" required type="text" id="username" class="w-full bg-neutral-dark-900 border border-neutral-dark-700 rounded-lg p-2.5 focus:outline-none focus:ring-2 focus:ring-brand-purple-light focus:border-brand-purple-light"> 
                        </div>
                        <div class="md:col-span-2"> 
                            <label for="bio" class="block text-sm font-medium text-neutral-dark-300 mb-1">Bio</label> 
                            <textarea id="bio" rows="4" class="w-full bg-neutral-dark-900 border border-neutral-dark-700 rounded-lg p-2.5 focus:outline-none focus:ring-2 focus:ring-brand-purple-light focus:border-brand-purple-light">Ciao sno davide, uno strudente di ingegneria e ho 22 anni studio in Sapienza e vivo a ROma</textarea>
                        </div>
                    </div>
                </div>

                <div class="bg-neutral-dark-950 border border-neutral-dark-800 rounded-xl p-6">
                    <h2 class="text-lg font-semibold text-neutral-dark-100">Additional Information</h2>
                    <p class="text-sm text-neutral-dark-400 mb-6">Optional details about yourself</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div> 
                            <label for="location" class="block text-sm font-medium text-neutral-dark-300 mb-1">Location</label> 
                            <input value="Rome, IT" type="text" id="location" class="w-full bg-neutral-dark-900 border border-neutral-dark-700 rounded-lg p-2.5 focus:outline-none focus:ring-2 focus:ring-brand-purple-light focus:border-brand-purple-light"> 
                        </div>
                        <div> 
                            <label for="website" class="block text-sm font-medium text-neutral-dark-300 mb-1">Website</label> 
                            <input value="google.com" type="url" id="website" class="w-full bg-neutral-dark-900 border border-neutral-dark-700 rounded-lg p-2.5 focus:outline-none focus:ring-2 focus:ring-brand-purple-light focus:border-brand-purple-light">
                        </div>
                        <div> 
                            <label for="birthdate" class="block text-sm font-medium text-neutral-dark-300 mb-1">Birthdate (Optional)</label> 
                            <input value="29 july 2003" type="text" id="birthdate" placeholder="Born..." class="w-full bg-neutral-dark-900 border border-neutral-dark-700 rounded-lg p-2.5 focus:outline-none focus:ring-2 focus:ring-brand-purple-light focus:border-brand-purple-light"> 
                        </div>
                    </div>
                </div>
                

                <div class="flex justify-end gap-4 pt-6 border-t border-neutral-dark-800">
                    <button type="button" id="cancel-edit-btn" class="px-6 py-2.5 rounded-lg bg-neutral-dark-800 text-neutral-dark-200 hover:bg-neutral-dark-700 font-semibold transition-colors">Cancel</button>
                    <button type="submit" class="px-6 py-2.5 rounded-lg bg-brand-purple hover:bg-brand-purple-dark text-white font-semibold transition-colors">Save Changes</button>
                </div>
            </form>
        </div>
    </main>

    <!-- MODAL PER IL CROPPER DELL'IMMAGINE PROFILO -->
    <div id="cropper-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 cropper-bg">
        <div class="bg-neutral-dark-900 rounded-xl shadow-lg p-6 w-full max-w-md mx-auto">
            <h2 class="text-xl font-bold text-white mb-4">Crop your new picture</h2>
            <div class="cropper-container-modal">
                <img id="image-to-crop" src="">
            </div>
            <div class="flex justify-end gap-4 mt-6">
                <button type="button" id="cancel-crop-btn" class="px-6 py-2.5 rounded-lg bg-neutral-dark-800 text-neutral-dark-200 hover:bg-neutral-dark-700 font-semibold transition-colors">Cancel</button>
                <button type="button" id="crop-image-btn" class="px-6 py-2.5 rounded-lg bg-brand-purple hover:bg-brand-purple-dark text-white font-semibold transition-colors">Crop & Save</button>
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- URL FOTO PROFILO PREDEFINITA ---
            const defaultProfilePicUrl = `default-avatar-circle.jpg`;
            
            // --- STATO DEL PROFILO ---
            let profileData = {};

            // --- Elementi del DOM ---
            const profileView = document.getElementById('profile-view');
            const editProfileView = document.getElementById('edit-profile-view');
            
            // Pulsanti di navigazione
            const editProfileBtn = document.getElementById('edit-profile-btn');
            const backToProfileBtn = document.getElementById('back-to-profile-btn');
            const cancelEditBtn = document.getElementById('cancel-edit-btn');
            const editProfileForm = document.getElementById('edit-profile-form');

            // Gestione foto e CROPPER
            const profilePicUpload = document.getElementById('profile-picture-upload');
            const revertDefaultPicBtn = document.getElementById('revert-default-pic-btn');
            const cropperModal = document.getElementById('cropper-modal');
            const imageToCrop = document.getElementById('image-to-crop');
            const cropImageBtn = document.getElementById('crop-image-btn');
            const cancelCropBtn = document.getElementById('cancel-crop-btn');
            
            let cropper = null; // Variabile per contenere l'istanza di Cropper.js

            // --- Funzioni di Gestione ---

            function loadInitialDataFromDOM() {
                profileData = {
                    firstName: document.getElementById('first-name').value.trim(),
                    lastName: document.getElementById('last-name').value.trim(),
                    username: document.getElementById('username').value.trim(),
                    bio: document.getElementById('bio').value.trim(),
                    location: document.getElementById('location').value.trim(),
                    website: document.getElementById('website').value.trim(),
                    birthdate: document.getElementById('birthdate').value.trim(),
                    profilePicUrl: document.getElementById('profile-pic-edit-preview').src, 
                };
                console.log("Dati iniziali caricati dal DOM:", profileData);
            }

            // Aggiorna la VISTA DEL PROFILO leggendo da `profileData`
            function updateProfileDisplay() {
                document.getElementById('profile-name-display').innerText = `${profileData.firstName} ${profileData.lastName}`;
                document.getElementById('profile-username-display').innerText = `@${profileData.username}`;
                document.getElementById('profile-pic-display').src = profileData.profilePicUrl;
                
                const bioDisplay = document.getElementById('profile-bio-display');
                bioDisplay.innerText = profileData.bio;
                bioDisplay.style.display = profileData.bio ? 'block' : 'none';

                const locationContainer = document.getElementById('profile-location-display');
                if (profileData.location) {
                    locationContainer.style.display = 'flex';
                    locationContainer.querySelector('span').innerText = profileData.location;
                } else { 
                    locationContainer.style.display = 'none';
                }

                const birthdateContainer = document.getElementById('profile-birthdate-display');
                if (profileData.birthdate) {
                    birthdateContainer.style.display = 'flex';
                    birthdateContainer.querySelector('span').innerText = `Born ${profileData.birthdate}`;
                } else {
                    birthdateContainer.style.display = 'none';
                }

                const websiteContainer = document.getElementById('profile-website-display');
                if (profileData.website) {
                    websiteContainer.style.display = 'flex';
                    const websiteLink = websiteContainer.querySelector('a');
                    // Assicuriamoci che l'URL sia valido per il link
                    let href = profileData.website;
                    if (!/^(https?:\/\/)/i.test(href)) {
                        href = 'https://' + href;
                    }
                    websiteLink.href = href;
                    // Mostriamo una versione pulita del link
                    websiteLink.innerText = profileData.website.replace(/^(https?:\/\/)/, '');
                } else {
                    websiteContainer.style.display = 'none';
                }
            }

            // Popola il MODULO DI MODIFICA leggendo da `profileData`
            function populateEditForm() {
                document.getElementById('first-name').value = profileData.firstName;
                document.getElementById('last-name').value = profileData.lastName;
                document.getElementById('username').value = profileData.username;
                document.getElementById('bio').value = profileData.bio;
                document.getElementById('location').value = profileData.location;
                document.getElementById('website').value = profileData.website;
                document.getElementById('birthdate').value = profileData.birthdate;
                document.getElementById('profile-pic-edit-preview').src = profileData.profilePicUrl;
            }

            // Funzioni per mostrare/nascondere le viste
            function showProfileView() {
                profileView.classList.remove('hidden');
                editProfileView.classList.add('hidden');
            }

            function showEditProfileView() {
                // Prima di mostrare il form, assicuriamoci che sia sincronizzato con lo stato attuale
                populateEditForm();
                profileView.classList.add('hidden');
                editProfileView.classList.remove('hidden');
            }

            // Salva le modifiche dal form nello stato `profileData`
            function saveProfileChanges() {
                const newFirstName = document.getElementById('first-name').value.trim();
                const newLastName = document.getElementById('last-name').value.trim();
                const newUsername = document.getElementById('username').value.trim();
                const newBio = document.getElementById('bio').value.trim();
                const newLocation = document.getElementById('location').value.trim();
                let newWebsite = document.getElementById('website').value.trim();
                const newBirthdate = document.getElementById('birthdate').value.trim();
                
                // Aggiorna lo stato in `profileData`
                profileData.firstName = newFirstName;
                profileData.lastName = newLastName;
                profileData.username = newUsername;
                profileData.bio = newBio;
                profileData.location = newLocation;
                profileData.website = newWebsite;
                profileData.birthdate = newBirthdate;
                // L'URL della foto viene preso direttamente dall'anteprima, che è stata aggiornata dal cropper o dal revert
                profileData.profilePicUrl = document.getElementById('profile-pic-edit-preview').src;

                // Aggiorna la vista del profilo con i nuovi dati salvati
                updateProfileDisplay();
                
                showProfileView();
            }


            // --- Event Listeners ---
            
            // Navigazione
            editProfileBtn.addEventListener('click', showEditProfileView);
            backToProfileBtn.addEventListener('click', showProfileView);

            cancelEditBtn.addEventListener('click', () => {
                showProfileView();
            });

            // Salvataggio
            editProfileForm.addEventListener('submit', (e) => {
                e.preventDefault(); // Impedisce il ricaricamento della pagina
                saveProfileChanges();
            });

            // --- LOGICA DEL CROPPER ---

            // 1. Quando l'utente seleziona un file
            profilePicUpload.addEventListener('change', event => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = e => {
                        // Imposta l'immagine nel modal del cropper
                        imageToCrop.src = e.target.result;
                        // Mostra il modal
                        cropperModal.classList.remove('hidden');
                        // Inizializza Cropper.js
                        cropper = new Cropper(imageToCrop, {
                            aspectRatio: 1 / 1, // Per un ritaglio quadrato
                            viewMode: 1,        // Limita il ritaglio all'area dell'immagine
                            dragMode: 'move',
                            guides: false,
                            center: false,
                            background: false,
                            cropBoxMovable: true,
                            cropBoxResizable: true,
                        });
                    };
                    reader.readAsDataURL(file);
                }
                // Resetta il valore dell'input per permettere di caricare lo stesso file di nuovo
                event.target.value = '';
            });

            // 2. Quando l'utente clicca su "Crop & Save" nel modal
            cropImageBtn.addEventListener('click', () => {
                if (cropper) {
                    // Ottieni il canvas ritagliato
                    const canvas = cropper.getCroppedCanvas({
                        width: 256,  // Definisci la dimensione dell'output
                        height: 256,
                    });

                    // Converte il canvas in un URL dati (base64)
                    const croppedImageUrl = canvas.toDataURL('image/jpeg');

                    // Aggiorna l'anteprima nella pagina di modifica
                    document.getElementById('profile-pic-edit-preview').src = croppedImageUrl;
                    
                    // Chiudi e resetta il modal/cropper
                    cropperModal.classList.add('hidden');
                    cropper.destroy();
                    cropper = null;
                }
            });

            // 3. Quando l'utente clicca su "Cancel" nel modal
            cancelCropBtn.addEventListener('click', () => {
                cropperModal.classList.add('hidden');
                if (cropper) {
                    cropper.destroy();
                    cropper = null;
                }
            });

            // Pulsante per tornare all'immagine di default
            revertDefaultPicBtn.addEventListener('click', () => {
                document.getElementById('profile-pic-edit-preview').src = defaultProfilePicUrl;
            });
            
            // Gestione schede 
            const tabButtons = document.querySelectorAll('.tab-btn');
            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
                    document.getElementById(button.dataset.tab).classList.remove('hidden');
                    tabButtons.forEach(btn => btn.classList.replace('tab-active', 'tab-inactive'));
                    button.classList.replace('tab-inactive', 'tab-active');
                });
            });

            // --- Inizializzazione ---
            loadInitialDataFromDOM();
            updateProfileDisplay(); 

        });
    </script>
</body>
</html>
