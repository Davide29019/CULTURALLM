<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cultural Questions - CULTURALLM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #000000;
        }
        .gradient-text {
            background: linear-gradient(to right, #d8b4fe, #7c3aed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .card {
            background-color: #0F0F0F; /* Un nero leggermente pi√π chiaro per le card */
            border: 1px solid #2C2C2E; /* neutral-dark-800 */
        }
        /* Stili per la scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1C1C1E;
        }
        ::-webkit-scrollbar-thumb {
            background: #3A3A3C;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #A855F7;
        }
                /* Stili aggiuntivi per nascondere la scrollbar dei tag */
        .no-scrollbar::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
        }
        .no-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand-purple': {
                            light: '#A855F7',
                            DEFAULT: '#9333EA',
                            dark: '#7E22CE'
                        },
                        'neutral-dark': {
                            950: '#0F0F0F',
                            900: '#1C1C1E',
                            800: '#2C2C2E',
                            700: '#3A3A3C',
                            400: '#A0A0A0',
                            300: '#D1D5DB',
                            200: '#E5E7EB',
                            100: '#F3F4F6'
                        }
                    },
                    maxWidth: {
                        'screen-2xl': '1536px',
                    }
                }
            }
        }
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
</head>

<body class="text-neutral-dark-300 selection:bg-brand-purple selection:text-white">

    <!-- Navbar (Codice fornito e mantenuto) -->
   <!-- Navbar -->
    <header class="sticky top-0 z-50 bg-black backdrop-blur-md border-b border-neutral-dark-800">
        <div class="w-full max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex-shrink-0">
                    <a href="/home" class="text-2xl font-extrabold gradient-text">CULTURALLM</a>
                </div>
                <div class="flex-1 px-4 lg:px-12">
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <ion-icon name="search-outline" class="text-neutral-dark-400"></ion-icon>
                        </div>
                        <input type="search" name="search" id="search"
                            class="block w-full pl-10 pr-3 py-2.5 bg-neutral-dark-900 border border-neutral-dark-800 rounded-lg
                                    text-neutral-dark-300 placeholder-neutral-dark-400 focus:outline-none
                                    focus:ring-1 focus:ring-brand-purple focus:border-brand-purple sm:text-sm"
                            placeholder="Search questions, topics, cultures...">
                    </div>
                </div>

                <!--{/* Icone a destra per schermi grandi */}-->
                <div class="hidden lg:flex items-center space-x-3 sm:space-x-4">
                    <form id="post_question-form" action="/post_question" method="get" style="display: none;"></form>

                    <a href="/post_question" 
                    title="Create a Question" 
                    class="p-1.5 rounded-full text-white hover:text-brand-purple-light hover:bg-neutral-dark-800 transition-colors hover:rounded-md">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
                    </a>


                     <a href="/questions" 
                    title="Question Dashboard" 
                    class="p-1.5 rounded-full text-white hover:text-brand-purple-light hover:bg-neutral-dark-800 transition-colors hover:rounded-md">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v16a2 2 0 0 0 2 2h16"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/></svg>
                    </a>

                    <a href="/your_profile_page" 
                    title="Profile" 
                    class="p-1.5 rounded-full text-white hover:text-brand-purple-light hover:bg-neutral-dark-800 transition-colors hover:rounded-md"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                    </a>

                    <a href="/setting_page" 
                    title="Settings" 
                    class="p-1.5 rounded-full text-white hover:text-brand-purple-light hover:bg-neutral-dark-800 transition-colors hover:rounded-md"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>

                    </a>

                    <a href="/missions" 
                    title="Mission & Challenge" 
                    class="p-1.5 rounded-full text-white hover:text-brand-purple-light hover:bg-neutral-dark-800 transition-colors hover:rounded-md"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978"/><path d="M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978"/><path d="M18 9h1.5a1 1 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z"/><path d="M6 9H4.5a1 1 0 0 1 0-5H6"/></svg>

                    </a>

                    <a href="/notifications" 
                    title="Notifications" 
                    class="p-1.5 rounded-full text-white hover:text-brand-purple-light hover:bg-neutral-dark-800 transition-colors hover:rounded-md"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.268 21a2 2 0 0 0 3.464 0"/><path d="M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326"/></svg>
                        <!-- <span class="absolute top-0.5 right-0.5 block h-2 w-2 rounded-full ring-2 ring-black bg-red-500"></span> Esempio notifica -->

                    </a>

                     <a href="/shop_page" 
                    title="Shop" 
                    class="p-1.5 rounded-full text-white hover:text-brand-purple-light hover:bg-neutral-dark-800 transition-colors hover:rounded-md"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 10a4 4 0 0 1-8 0"/><path d="M3.103 6.034h17.794"/><path d="M3.4 5.467a2 2 0 0 0-.4 1.2V20a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6.667a2 2 0 0 0-.4-1.2l-2-2.667A2 2 0 0 0 17 2H7a2 2 0 0 0-1.6.8z"/></svg>

                    </a>

                    <a href="/message_page" 
                    title="Message" 
                    class="p-1.5 rounded-full text-white hover:text-brand-purple-light hover:bg-neutral-dark-800 transition-colors hover:rounded-md"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"/></svg>

                    </a>

                    <div class="w-px h-6 bg-gray-500 opacity-50"></div>
                    <!-- Form invisibile necessario per avere logout come app.post-->
                    <form id="logout-form" action="/logout" method="post" style="display: none;"></form>

                    <!-- Link che invia il form -->
                    <a href="#" 
                    title="Log-out" 
                    class="p-1.5 rounded-full text-red-500 hover:text-white hover:bg-neutral-dark-800 transition-colors hover:rounded-md inline-flex items-center justify-center"
                    onclick="event.preventDefault(); document.getElementById('logout-form').submit();">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="m16 17 5-5-5-5"/>
                            <path d="M21 12H9"/>
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                        </svg>
                    </a>

                </div>

                <!--{/* Pulsante Hamburger per schermi piccoli e Menu Dropdown */}-->
                <div class="lg:hidden flex items-center">
                    <button id="mobileMenuButton" class="p-2 rounded-md text-white hover:text-brand-purple-light hover:bg-neutral-dark-800 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-brand-purple-light">
                        <span class="sr-only">Open main menu</span>
                        <ion-icon name="menu-outline" id="menuIconOpen" class="block h-6 w-6"></ion-icon>
                        <ion-icon name="close-outline" id="menuIconClose" class="hidden h-6 w-6"></ion-icon>
                    </button>
                </div>
            </div>

            <!--{/* Menu Dropdown Mobile - inizialmente nascosto */}-->
            <div id="mobileMenu" class="hidden lg:hidden absolute right-4 mt-2 w-56 origin-top-right bg-neutral-dark-900 border border-neutral-dark-800 rounded-md shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none" role="menu" aria-orientation="vertical" aria-labelledby="mobileMenuButton" tabindex="-1">
                <div class="py-1" role="none">
                    <a href="/post_question" title="Create a Question" class="flex items-center px-4 py-2 text-sm text-neutral-dark-200 hover:bg-neutral-dark-800 hover:text-brand-purple-light" role="menuitem" tabindex="-1">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
                        Create
                    </a>
                    <a href="/questions" title="Question Dashboard" class="flex items-center px-4 py-2 text-sm text-neutral-dark-200 hover:bg-neutral-dark-800 hover:text-brand-purple-light" role="menuitem" tabindex="-1">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v16a2 2 0 0 0 2 2h16"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/></svg>
                        Dashboard
                    </a>
                    <a href="/your_profile_page" title="Profile" class="flex items-center px-4 py-2 text-sm text-neutral-dark-200 hover:bg-neutral-dark-800 hover:text-brand-purple-light" role="menuitem" tabindex="-1"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                        Profile
                    </a>
                    <a href="/setting_page" title="Settings" class="flex items-center px-4 py-2 text-sm text-neutral-dark-200 hover:bg-neutral-dark-800 hover:text-brand-purple-light" role="menuitem" tabindex="-1">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
                        Settings
                    </a>
                    <a href="/missions" title="Mission & Challenge" class="flex items-center px-4 py-2 text-sm text-neutral-dark-200 hover:bg-neutral-dark-800 hover:text-brand-purple-light" role="menuitem" tabindex="-1">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978"/><path d="M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978"/><path d="M18 9h1.5a1 1 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z"/><path d="M6 9H4.5a1 1 0 0 1 0-5H6"/></svg>
                        Missions
                    </a>
                    <a href="/notifications" title="Notifications" class="flex items-center px-4 py-2 text-sm text-neutral-dark-200 hover:bg-neutral-dark-800 hover:text-brand-purple-light relative" role="menuitem" tabindex="-1">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.268 21a2 2 0 0 0 3.464 0"/><path d="M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326"/></svg>
                        Notifications
                        <!-- <span class="absolute top-1.5 right-3 block h-2 w-2 rounded-full bg-red-500"></span> Esempio notifica nel menu -->
                    </a>
                    <a href="/shop_page" title="Shop" class="flex items-center px-4 py-2 text-sm text-neutral-dark-200 hover:bg-neutral-dark-800 hover:text-brand-purple-light" role="menuitem" tabindex="-1">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 10a4 4 0 0 1-8 0"/><path d="M3.103 6.034h17.794"/><path d="M3.4 5.467a2 2 0 0 0-.4 1.2V20a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6.667a2 2 0 0 0-.4-1.2l-2-2.667A2 2 0 0 0 17 2H7a2 2 0 0 0-1.6.8z"/></svg>
                        Shop
                    </a>
                    <a href="/message_page" title="Message" class="flex items-center px-4 py-2 text-sm text-neutral-dark-200 hover:bg-neutral-dark-800 hover:text-brand-purple-light" role="menuitem" tabindex="-1">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"/></svg>
                        Messages
                    </a>
                    <div class="border-t border-neutral-dark-700 mx-2 my-1"></div>
                    <form id="logout-form" action="/logout" method="post" style="display: none;"></form>
                    <a href="#" title="Log-out" class="flex items-center px-4 py-2 text-sm text-red-500 hover:bg-neutral-dark-800 hover:text-red-400" role="menuitem" tabindex="-1"
                    onclick="event.preventDefault(); document.getElementById('logout-form').submit();">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m16 17 5-5-5-5"/><path d="M21 12H9"/><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/></svg>
                        Log-out
                    </a>
                </div>
            </div>
        </div>
    </header>

    <main class="w-full max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- Intestazione Principale -->
        <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6">
            <div>
                <h1 class="text-3xl md:text-4xl font-extrabold text-neutral-dark-100">Cultural Questions</h1>
                <p class="text-neutral-dark-400 mt-1">Explore and contribute to our growing collection of cultural knowledge</p>
            </div>

            <a href="#" 
                    title="Create a Question" 
                    class="flex items-center gap-2 bg-brand-purple hover:bg-brand-purple-dark transition-colors text-white font-semibold py-2.5 px-5 rounded-lg mt-4 sm:mt-0 whitespace-nowrap"
                    onclick="event.preventDefault(); document.getElementById('post_question-form').submit();">


    
                <ion-icon name="add-outline" class="text-xl"></ion-icon>
                Ask Question
                </a>
        </div>

        <!-- Barra Filtri e Topic - Aggiornata -->
        <div class="mb-6 space-y-4">
            <div class="flex flex-col md:flex-row md:items-center gap-4">
                <!-- Campo ricerca -->
                <div class="relative flex-grow">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <ion-icon name="search-outline" class="text-neutral-dark-400"></ion-icon>
                </div>
                <input type="search" name="search-topics" id="search-topics"
                    class="block w-full pl-10 pr-3 py-2.5 bg-neutral-dark-950 border border-neutral-dark-800 rounded-lg
                        text-neutral-dark-300 placeholder-neutral-dark-400 focus:outline-none
                        focus:ring-1 focus:ring-brand-purple focus:border-brand-purple sm:text-sm"
                    placeholder="Search questions, topics, or cultures...">
                </div>

                <!-- Filtri Ordinamento + Stato -->
                <div class="flex space-x-2 relative z-10">
                <!-- Ordinamento -->
                <div class="relative">
                    <button id="sortButton" class="flex items-center justify-between px-4 py-2.5 bg-neutral-dark-950 border border-neutral-dark-800 rounded-lg text-sm text-neutral-dark-300 w-48 hover:bg-neutral-dark-900">
                        <span id="sortLabel" class="whitespace-nowrap">Most Recent</span>
                        <ion-icon name="chevron-down-outline" class="ml-2 text-lg"></ion-icon>
                    </button>
                    <div id="sortMenu" class="hidden absolute mt-2 w-48 bg-neutral-dark-900 border border-neutral-dark-800 rounded-lg shadow-lg text-sm text-neutral-dark-300">
                        <button class="block w-full text-left px-4 py-2 hover:bg-neutral-dark-800" data-value="most-recent">Most Recent</button>
                        <button class="block w-full text-left px-4 py-2 hover:bg-neutral-dark-800" data-value="most-voted">Most Popular</button>
                        <button class="block w-full text-left px-4 py-2 hover:bg-neutral-dark-800" data-value="most-answered">Most Answered</button>
                        <button class="block w-full text-left px-4 py-2 hover:bg-neutral-dark-800" data-value="unanswered">Unanswered</button>
                    </div>
                </div>

                <!-- Stato -->
                <div class="relative">
                    <button id="statusButton" class="flex items-center justify-between px-4 py-2.5 bg-neutral-dark-950 border border-neutral-dark-800 rounded-lg text-sm text-neutral-dark-300 w-36 hover:bg-neutral-dark-900">
                    <span id="statusLabel">All Status</span>
                    <ion-icon name="chevron-down-outline" class="ml-2 text-lg"></ion-icon>
                    </button>
                    <div id="statusMenu" class="hidden absolute mt-2 w-36 bg-neutral-dark-900 border border-neutral-dark-800 rounded-lg shadow-lg text-sm text-neutral-dark-300">
                    <button class="block w-full text-left px-4 py-2 hover:bg-neutral-dark-800" data-value="all">All Status</button>
                    <button class="block w-full text-left px-4 py-2 hover:bg-neutral-dark-800" data-value="active"><span class="inline-block w-2 h-2 rounded-full bg-green-400 mr-2"></span>Active</button>
                    <button class="block w-full text-left px-4 py-2 hover:bg-neutral-dark-800" data-value="ranking"><span class="inline-block w-2 h-2 rounded-full bg-orange-400 mr-2"></span>Ranking</button>
                    <button class="block w-full text-left px-4 py-2 hover:bg-neutral-dark-800" data-value="closed"><span class="inline-block w-2 h-2 rounded-full bg-red-400 mr-2"></span>Closed</button>
                    </div>
                </div>
                </div>
            </div>

            <!--SEZIONE TAG TOPICS: con scroll infinito -->
            <div id="topic-tags-container" class="relative group flex items-center gap-2">
                <!-- Pulsante Scroll Sinistra -->
                <button id="scroll-left-btn" class="hidden flex-shrink-0 z-10 p-1.5 bg-neutral-dark-900 border border-neutral-dark-800 rounded-full text-white hover:bg-brand-purple transition-colors">
                    <ion-icon name="chevron-back-outline" class="pointer-events-none"></ion-icon>
                </button>
                
                <!-- Contenitore che nasconde l'overflow -->
                <div id="topic-tags-scroll-area" class="flex-grow overflow-hidden">
                    <!-- Wrapper che contiene i tag e che verr√† animato -->
                    <div id="tags-wrapper" class="flex items-center space-x-2 whitespace-nowrap transition-transform duration-300 ease-in-out">
                        <a href="#" class="topic-tag active flex-shrink-0 px-3 py-1.5 text-sm font-medium rounded-full cursor-pointer transition-colors" data-topic="all">All Topics</a>
                        {%for key in themes%}
                        {%set theme = themes[key]%}
                        <a href="#" class="topic-tag flex-shrink-0 px-3 py-1.5 text-sm font-medium rounded-full cursor-pointer transition-colors" data-topic="{{theme['name']}}">{{theme['name']}}</a>
                        {%endfor%}
                  </div>
                </div>
                
                <!-- Pulsante Scroll Destra -->
                <button id="scroll-right-btn" class="hidden flex-shrink-0 z-10 p-1.5 bg-neutral-dark-900 border border-neutral-dark-800 rounded-full text-white hover:bg-brand-purple transition-colors">
                    <ion-icon name="chevron-forward-outline" class="pointer-events-none"></ion-icon>
                </button>
            </div>
        </div>


        <!-- Lista delle Domande -->
        <div id="questions-container" class="space-y-4 ">
            
            {%if question_obj%}

            <div id="question-obj" data-question-id="{{ question_obj }}"></div>
            {%endif%}
            <!-- Card Domande active-->
             {%for key in questions%}
                {%set question = questions[key]%}
                
                <article class="card rounded-xl question-card" 
                data-answered="{{question['answered']}}" data-date="{{question['created_at']}}" 
                data-votes="{{question['upvotes']}}" data-answers="{{question['number_answer']}}" 
                data-question-id="{{question['question_id']}}" 
                data-status="{%if question['status'] == 'open'%}active{%endif%}{%if question['status'] == 'ranking'%}ranking{%endif%}{%if question['status'] == 'close'%}closed{%endif%}">
                <div class="p-6">
                    <div class="flex space-x-4">
                        <div class="flex-shrink-0">
                            {%if question['creator_type' == 'user']%}
                            <img src="{{question['avatar']}}" class="w-10 h-10 rounded-full flex items-center justify-center font-bold text-white text-lg">
                            {%endif%}
                        </div>
                        <div class="flex-1">
                            <div class="flex items-center justify-between">
                                <div>
                                    <span class="font-semibold text-neutral-dark-200">{{question['creator']}}</span>
                                    <span class="text-sm text-neutral-dark-400 ml-2">‚Ä¢ {{question['hours']}} {{question['hours_type']}} ago</span>
                                
                                </div>
                                     <div class="flex items-center text-sm text-neutral-dark-300" >
                                    
                                    {%if question['status'] == 'open'%} <span class="inline-block w-2 h-2 mr-2 rounded-full bg-green-400"></span> Active {%endif%}
                                    {%if question['status'] == 'ranking'%} 
                                    <span class="inline-block w-2 h-2 mr-2 rounded-full bg-orange-400"></span>
                                    Ranking
                                    {%endif%}
                                    {%if question['status'] == 'close'%}
                                    <span class="inline-block w-2 h-2 mr-2 rounded-full bg-red-400"></span>
                                    Closed
                                {%endif%}
                                </div>
                            </div>

                
                            <p class="mt-3 text-base text-neutral-dark-200 leading-relaxed hover:text-brand-purple-light transition-colors cursor-pointer"  
                            data-action="{%if question['status'] == 'open'%}toggle-answer{%endif%}{%if question['status'] == 'ranking'%}toggle-ranking{%endif%}{%if question['status'] == 'close'%}toggle-final{%endif%}">
                                {{question['question_text']}}
                            </p>
                            

                            <form id="upvote-form-{{key}}" action="/upvote" method="post" style="display: none;">
                                <input type="hidden" name="question_id" value="{{question['question_id']}}">
                            </form>
                            <form id="downvote-form-{{key}}" action="/downvote" method="post" style="display: none;">
                                <input type="hidden" name="question_id" value="{{question['question_id']}}">
                            </form>
                            <form id="remove_upvote-form-{{key}}" action="/remove_upvote" method="post" style="display: none;">
                                <input type="hidden" name="question_id" value="{{question['question_id']}}">
                            </form>
                            <form id="remove_downvote-form-{{key}}" action="/remove_downvote" method="post" style="display: none;">
                                <input type="hidden" name="question_id" value="{{question['question_id']}}">
                            </form>
                            <form id="report-form-{{key}}" action="/report" method="post" style="display: none;">
                                <input type="hidden" name="question_id" value="{{question['question_id']}}">
                            </form>
                            <form id="remove_report-form-{{key}}" action="/remove_report" method="post" style="display: none;">
                                <input type="hidden" name="question_id" value="{{question['question_id']}}">
                            </form>
                            <div class="flex items-center space-x-6 mt-4">
                                



                                <a href="#" 
                                    title="upvote" 
                                    class="flex items-center space-x-1.5 text-neutral-dark-400  hover:text-brand-purple-light transition-colors"
                                    {%if question['user_upvote'] == '0'%}

                                    onclick="event.preventDefault(); document.getElementById('upvote-form-{{key}}').submit();"

                                    {%else%}
                                    onclick="event.preventDefault(); document.getElementById('remove_upvote-form-{{key}}').submit();"
                                    {%endif%}
                                    >
                                    <ion-icon name="arrow-up{%if question['user_upvote'] == '0'%}-outline{%endif%}" class="text-lg {%if question['user_upvote'] != '0'%} text-brand-purple-light {%endif%} "></ion-icon>
                                    <span class="text-sm font-medium">{{question['upvotes']}}</span>
                                </a>


                                <a href="#" 
                                    title="downvote" 
                                    class="flex items-center space-x-1.5 text-neutral-dark-400 hover:text-red-500 transition-colors"
                                    {%if question['user_downvote'] == '0'%}

                                    onclick="event.preventDefault(); document.getElementById('downvote-form-{{key}}').submit();"

                                    {%else%}
                                    onclick="event.preventDefault(); document.getElementById('remove_downvote-form-{{key}}').submit();"
                                    {%endif%}
                                    >
                                    <ion-icon name="arrow-down{%if question['user_downvote'] == '0'%}-outline{%endif%}" class="text-lg {%if question['user_downvote'] != '0'%} text-red-500 {%endif%}"></ion-icon>
                                    <span class="text-sm font-medium">{{question['downvotes']}}</span>
                                </a>

                                {%if question['status'] == 'open' or question['status'] == 'close'%}
                                    <button title="Number of answers" class="flex items-center space-x-1.5 text-neutral-dark-400 hover:text-white transition-colors" 
                                    data-action="{%if question['status']=='open'%}toggle-answer{%else%}toggle-final{%endif%}">
                                    <ion-icon name="chatbubble-outline" class="text-lg"></ion-icon>
                                    <span class="text-sm font-medium">{{question['number_answer']}}</span>
                                    </button>
                                {%endif%}
                                 {%if question['status'] == 'ranking'%}
                                 <button title="Number of rankings" class="flex items-center space-x-1.5 text-neutral-dark-400 hover:text-white transition-colors" data-action="toggle-ranking">
                                    <ion-icon name="trending-up-outline" class="text-lg"></ion-icon>
                                    <span class="text-sm font-medium">{{question['ranking_times']}}</span>
                                </button>
                                 {%endif%}
                                
                                <button class="copy-link-btn flex items-center space-x-1.5 text-neutral-dark-400 hover:text-white transition-colors">
                                    <ion-icon name="share-social-outline" class="text-lg"></ion-icon>
                                </button>

                                <a href="#" title="report" class="flex items-center space-x-1.5 text-neutral-dark-400 {%if question['report'] == '0'%}hover:{%endif%}text-red-500 transition-colors"
                                 {%if question['report'] == '0'%}

                                    onclick="event.preventDefault(); document.getElementById('report-form-{{key}}').submit();"

                                    {%else%}
                                    onclick="event.preventDefault(); document.getElementById('remove_report-form-{{key}}').submit();"
                                    {%endif%}
                                >
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-shield-alert-icon lucide-shield-alert"><path d="M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z"/><path d="M12 8v4"/><path d="M12 16h.01"/></svg>
                                </a>

                                <button class="flex items-center space-x-1.5 text-neutral-dark-400 hover:text-white transition-colors">
                                    
                                </button>
                            </div>
                            <div class="flex flex-wrap gap-2 mt-4">
                                <span data-theme="{{question['theme']}}" class=" px-2 py-1 text-xs rounded-md bg-purple-300/10 text-brand-purple-light theme-span">{{question['theme']}}</span>
                                <span class="px-2 py-1 text-xs text-neutral-dark-400">‚Ä¢</span>

                                {%for tag in question['question_tags']%}
                                <span class="px-2 py-1 text-xs rounded-md bg-neutral-dark-800 text-neutral-dark-300">{{tag}}</span>
                                {%endfor%}
                            </div>
                        </div>
                    </div>
                </div>
                {%if question['status'] == 'open'%}
                 <!-- Sezione Risposta Rapida (nascosta di default) -->
                <div class="quick-answer-section hidden border-t border-neutral-dark-800 p-6">
                    <h3 class="text-sm font-semibold text-neutral-dark-200 mb-2">Quick Answer</h3>
                    <form id = "send_answer-form" action="/user_answer" method="POST">
                    <input type="hidden" name="question_id" value="{{question['question_id']}}">
                    <textarea name="answer_text" required class="w-full bg-neutral-dark-900 border border-neutral-dark-800 rounded-lg p-3 text-sm focus:outline-none focus:ring-2 focus:ring-brand-purple-light focus:border-brand-purple-light" rows="3" placeholder="Share your thoughts..."></textarea>
                    <div class="flex flex-col sm:flex-row sm:justify-end mt-3 space-y-3 sm:space-y-0 sm:space-x-4">
                        <button type="submit" class="bg-brand-purple hover:bg-brand-purple-dark text-white font-semibold py-2 px-4 rounded-lg text-sm">Submit Answer</button>
                        </form>
                        <form id="generate-answer-form" action="/llm_answer" method="POST" class="flex flex-col sm:flex-row sm:justify-end mt-3 space-y-3 sm:space-y-0 sm:space-x-4" >
                        <input type="hidden" name="question_id" value="{{question['question_id']}}">
                        <select name="llm" required
                                    class="llm-select block px-4 py-3 bg-neutral-dark-950 border border-neutral-dark-700 rounded-lg text-neutral-dark-300 placeholder-neutral-dark-400 focus:outline-none focus:ring-2 focus:ring-brand-purple-light focus:border-brand-purple-light mr-5">
                                <option value="" disabled selected>Select a model...</option>
                                {%for key in llms%}
                                    {%set llm = llms[key]%}
                                    <option value="{{llm['id']}}">{{llm['name']}}</option>
                                {%endfor%}
                            </select>


                    
                        <button type = "submit" class="generate-button bg-indigo-600 hover:bg-indigo-500 text-white font-semibold text-sm  py-2 px-4  rounded-lg transition-colors shadow-lg shadow-indigo-500/20 flex items-center space-x-2 mr-5">
                            <ion-icon name="sparkles-outline" class="text-lg"></ion-icon>
                            <span>Generate & Post</span>
                        </button>
                        </form>
                        
                    </div>
                </div>
                {%endif%}
                {%if question['status'] == 'ranking' and question['ranked'] == '0'%}


                <form id="ranking-form-{{key}}" action="/ranking" method="POST">
                <input type="hidden" name="question_id" id="question_id" value="{{question['question_id']}}">

                <input type="hidden" name="ranking_1" id="ranking_1" value="">
                <input type="hidden" name="ranking_2" id="ranking_2" value="">
                <input type="hidden" name="ranking_3" id="ranking_3" value="">
                <input type="hidden" name="ranking_4" id="ranking_4" value="">
                <input type="hidden" name="ranking_5" id="ranking_5" value="">



                <!-- Sezione Ranking (nascosta di default) al posto della Quick Answer -->
                <div class="ranking-section hidden border-t border-neutral-dark-800 p-6">
                    <h3 class="text-lg font-semibold text-neutral-dark-200 mb-2">Rank the Answers</h3>
                    <p class="text-sm text-neutral-dark-400 mb-4">Click on the answers in the order you want to rank them (up to 5).</p>

                    <!-- Contenitore per le risposte da classificare -->
                    <div id="ranking-list-container" class="space-y-3 max-h-[24rem] overflow-y-auto pr-2">
                        {%for key in question['answers']%}
                        {%set answer = question['answers'][key]%}
                        <div class="selectable-answer flex items-center space-x-4 bg-neutral-dark-800 p-3 rounded-lg cursor-pointer transition-all hover:bg-neutral-dark-700" data-answer-id="{{answer['answer_id']}}">
                            <span class="rank-number font-bold text-lg text-brand-purple-light w-6 text-center"></span>
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-grip-vertical text-neutral-dark-500"><circle cx="9" cy="12" r="1"/><circle cx="9" cy="5" r="1"/><circle cx="9" cy="19" r="1"/><circle cx="15" cy="12" r="1"/><circle cx="15" cy="5" r="1"/><circle cx="15" cy="19" r="1"/></svg>
                            <div class="flex-1 p-3">
                                <p class="text-sm leading-snug text-neutral-dark-100 font-medium">{{answer['answer_text']}}</p>
                            </div>
                        </div>

                        {%endfor%}

                    </div>

                    <!-- Pulsanti di Azione -->
                    <div class="flex justify-end mt-4 space-x-4">
                        <button class="bg-neutral-dark-700 hover:bg-neutral-dark-600 text-white font-semibold py-2 px-4 rounded-lg text-sm transition-colors" data-action="toggle-ranking">Cancel</button>
                        <button class="save-ranking-btn bg-brand-purple hover:bg-brand-purple-dark text-white font-semibold py-2 px-4 rounded-lg text-sm transition-colors" type = "button">Save Ranking</button>
                    </div>
                </div>
                </form>
            
                {%endif%}

                {%if question['status'] == 'close' %}

                    <!-- Sezione in stato closed cioe per la classifica finale-->
                <div class="final-ranking-section hidden border-t border-neutral-dark-800 p-6">
                    <h3 class="text-lg font-semibold text-neutral-dark-200 mb-4">Top 5 Answers</h3>
                    
                    <!-- Contenitore scrollabile per le risposte classificate -->
                    <div class="space-y-3 max-h-[24rem] overflow-y-auto pr-2">
                        {%for key in question['answers']%}
                        {%set answer = question['answers'][key]%}
                        
                        <!-- Esempio Risposta #1 -->
                        <div class="flex items-center space-x-4 bg-neutral-dark-800 p-3 rounded-lg">
                            {%if key == '1'%}
                            <span class="rank-number font-bold text-lg text-yellow-400 w-6 text-center">1</span>
                            {%endif%}
                            {%if key == '2'%}
                            <span class="rank-number font-bold text-lg text-slate-400 w-6 text-center">2</span>
                            {%endif%}
                            {%if key == '3'%}
                            <span class="rank-number font-bold text-lg text-orange-400 w-6 text-center">3</span>
                            {%endif%}
                            {%if key == '4'%}
                            <span class="rank-number font-bold text-lg text-neutral-dark-300 w-6 text-center">4</span>
                            {%endif%}
                            {%if key == '5'%}
                            <span class="rank-number font-bold text-lg text-neutral-dark-300 w-6 text-center">5</span>
                            {%endif%}
                            
                            <div class="flex-1">
                                <p class="text-sm text-neutral-dark-200">Answer by <span class="font-semibold">{{answer['creator']}}</span></p>
                                <p class="text-xs text-neutral-dark-300">{{answer['answer_text']}}</p>
                            </div>
                            <div class="text-sm text-neutral-dark-300 flex items-center">
                                <ion-icon name="trophy-outline" class="text-lg text-brand-purple-light "></ion-icon>
                                <span class="ml-1">{{answer['points']}}</span>
                                <span class="ml-1 text-xs text-neutral-dark-400">points earned</span>
                            </div>
                        </div>
                        {%endfor%}

                        
                        
                    </div>
                </div>

                {%endif%}
                

            </article>

            {%endfor%}
            <!-- ------------------------------------------------>

           



        </div>
        
        <!-- Pulsante Carica Altro 
        <div class="flex justify-center mt-8">
            <button class="py-2.5 px-6 bg-neutral-dark-950 border border-neutral-dark-800 rounded-lg text-sm font-semibold text-neutral-dark-300 hover:bg-neutral-dark-900 hover:border-neutral-dark-700 transition-colors">
                Load More Questions
            </button>
        </div>
        -->
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Gestione Menu Mobile 
            const mobileMenuButton = document.getElementById('mobileMenuButton');
            const mobileMenu = document.getElementById('mobileMenu');
            const menuIconOpen = document.getElementById('menuIconOpen');
            const menuIconClose = document.getElementById('menuIconClose');

            if (mobileMenuButton) {
                mobileMenuButton.addEventListener('click', () => {
                    mobileMenu.classList.toggle('hidden');
                    menuIconOpen.classList.toggle('hidden');
                    menuIconClose.classList.toggle('hidden');
                });
            }

            // --- SETUP INIZIALE ---
            const questionsContainer = document.getElementById('questions-container');
            if (!questionsContainer) return; // Se il contenitore non esiste, non fare nulla

            // --- LOGICA PER RANKING INTERATTIVO ---
            const rankingStates = new Map(); // Map per tenere traccia dello stato di ranking per ogni card

            // Funzione helper per resettare lo stato di ranking di una card
            function resetRankingState(card) {
                if (!card) return;
                const state = rankingStates.get(card);
                if (state) {
                    state.rankedElements = [];
                }
                // Rimuovi gli stili e i numeri di ranking da tutte le risposte nella card
                card.querySelectorAll('.selectable-answer').forEach(answerEl => {
                    answerEl.classList.remove('border-brand-purple-light', 'border');
                    answerEl.querySelector('.rank-number').textContent = '';
                });
            }


            // --- GESTORE DI EVENTI UNIFICATO PER TUTTE LE CARD ---
            questionsContainer.addEventListener('click', (event) => {
                const card = event.target.closest('article.card');
                if (!card) return; // Se il click non √® avvenuto dentro una card, esci

                // =====================================================================
                // BLOCCO 1: LOGICA DI APERTURA/CHIUSURA DEI PANNELLI 
                // =====================================================================
                const toggleAnswerTrigger = event.target.closest('[data-action="toggle-answer"]');
                const toggleRankingTrigger = event.target.closest('[data-action="toggle-ranking"]');
                const toggleFinalTrigger = event.target.closest('[data-action="toggle-final"]');

                // Se √® stato cliccato uno qualsiasi dei trigger per aprire/chiudere un pannello
                if (toggleAnswerTrigger || toggleRankingTrigger || toggleFinalTrigger) {
                    let targetSection;

                    // Determina quale sezione deve essere aperta
                    if (toggleAnswerTrigger)  targetSection = card.querySelector('.quick-answer-section');
                    if (toggleRankingTrigger) targetSection = card.querySelector('.ranking-section');
                    if (toggleFinalTrigger)   targetSection = card.querySelector('.final-ranking-section');

                    if (!targetSection) return; // Se la sezione target non esiste in questa card, esci

                    const isAlreadyOpen = !targetSection.classList.contains('hidden');

                    // Chiudi TUTTI i pannelli apribili in TUTTE le card 
                    document.querySelectorAll('.quick-answer-section, .ranking-section, .final-ranking-section').forEach(section => {
                        // Se un pannello di ranking viene chiuso, resetta il suo stato
                        if (!section.classList.contains('hidden') && section.classList.contains('ranking-section')) {
                            resetRankingState(section.closest('article.card'));
                        }
                        section.classList.add('hidden');
                    });

                    // Se il pannello cliccato NON era gi√† aperto, aprilo
                    if (!isAlreadyOpen) {
                        targetSection.classList.remove('hidden');

                        // Azioni specifiche all'apertura
                        if (toggleRankingTrigger) {
                            rankingStates.set(card, { rankedElements: [] }); // Inizializza lo stato per il ranking
                        }
                        if (toggleAnswerTrigger) {
                            targetSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                            targetSection.querySelector('textarea')?.focus(); // Focus sulla textarea
                        }
                    }
                    return; // L'azione di click √® stata gestita, esci per evitare conflitti
                }

                // =====================================================================
                // BLOCCO 2: LOGICA PER AZIONI ALL'INTERNO DEI PANNELLI GI√Ä APERTI
                // =====================================================================

                // 2.1 Gestione Click su una risposta per il ranking (Selezione/Deselezione)
                const selectableAnswer = event.target.closest('.selectable-answer');
                if (selectableAnswer && rankingStates.has(card)) {
                    const state = rankingStates.get(card);
                    if (state.rankedElements.includes(selectableAnswer)) {
                        // Deselezione
                        const indexToRemove = state.rankedElements.indexOf(selectableAnswer);
                        state.rankedElements.splice(indexToRemove, 1);
                        selectableAnswer.classList.remove('border-brand-purple-light', 'border');
                        selectableAnswer.querySelector('.rank-number').textContent = '';
                        // Aggiorna i numeri delle altre risposte
                        state.rankedElements.forEach((el, newIndex) => {
                            el.querySelector('.rank-number').textContent = newIndex + 1;
                        });
                    } else {
                        // Selezione
                        if (state.rankedElements.length >= 5) {
                            alert("You can only rank up to 5 answers.");
                            return;
                        }
                        state.rankedElements.push(selectableAnswer);
                        selectableAnswer.classList.add('border-brand-purple-light', 'border');
                        selectableAnswer.querySelector('.rank-number').textContent = state.rankedElements.length;
                    }
                }

                // 2.2 Gestione salvataggio del ranking
                const saveButton = event.target.closest('.save-ranking-btn');
                if (saveButton && rankingStates.has(card)) {
                    const state = rankingStates.get(card);
                    if (state.rankedElements.length < 5) {
                        alert("Please rank five answers.");
                        return;
                    }

                    const form = saveButton.closest('form');
                    if (!form) {
                        alert("Form not found.");
                        return;
                    }

                    // Prendi l'id della domanda dal dataset della card e inseriscilo nell'input hidden del form
                    const questionIdInput = form.querySelector("#question_id");
                    if (questionIdInput) questionIdInput.value = card.dataset.questionId;

                    const finalRanking = state.rankedElements.map(el => el.dataset.answerId);

                    // Popola i 5 input hidden con gli id delle risposte selezionate
                    finalRanking.forEach((answerId, index) => {
                        const input = form.querySelector(`#ranking_${index + 1}`);
                        if (input) input.value = answerId;
                    });

                    // Azzerare eventuali campi non popolati (precauzione)
                    for (let i = finalRanking.length + 1; i <= 5; i++) {
                        const input = form.querySelector(`#ranking_${i}`);
                        if (input) input.value = "";
                    }

                    form.submit();
                }
                

                // 2.3 Gestione pulsante "Generate & Post"
                /*
                const generateButton = event.target.closest('.generate-button');
                if (generateButton) {
                    event.preventDefault();
                    const modelSelect = card.querySelector('.llm-select');
                    const textarea = card.querySelector('textarea');
                    if (!modelSelect.value) {
                        alert("Please select a model before generating an answer.");
                        modelSelect.style.borderColor = '#F87171'; // red-400
                        setTimeout(() => { modelSelect.style.borderColor = ''; }, 3000);
                        return;
                    }
                    
                    console.log(`Generating answer for Q(${card.dataset.questionId}) with model: ${modelSelect.value}`);
                    generateButton.disabled = true;
                    generateButton.innerHTML = `
                        <svg class="animate-spin h-5 w-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        Generating...
                    `;
                    /*
                    // Simula una chiamata API
                    setTimeout(() => {
                        generateButton.disabled = false;
                        generateButton.innerHTML = `
                            <ion-icon name="sparkles-outline" class="text-lg"></ion-icon>
                            <span>Generate & Post</span>
                        `;
                        textarea.value = `This is a generated answer from ${modelSelect.value}.`;
                    }, 2000);
                    
                }*/
            });
            // ====================================================================== //
            // CODICE PER LA GESTIONE DEI FILTRI TOPIC E SCROLLING
            // ====================================================================== //

            const scrollArea = document.getElementById('topic-tags-scroll-area');
            const scrollLeftBtn = document.getElementById('scroll-left-btn');
            const scrollRightBtn = document.getElementById('scroll-right-btn');
            
const tagsWrapper = document.getElementById('tags-wrapper');

const activeClasses = ['bg-brand-purple', 'text-white', 'border-transparent'];
const inactiveClasses = ['bg-neutral-dark-900', 'border-neutral-dark-800', 'text-neutral-dark-300', 'hover:bg-neutral-dark-800'];

function setTagStyle(tagElement, isActive) {
    if (!tagElement) return;
    if (isActive) {
        tagElement.classList.add(...activeClasses);
        tagElement.classList.remove(...inactiveClasses);
    } else {
        tagElement.classList.remove(...activeClasses);
        tagElement.classList.add(...inactiveClasses);
    }
}

function initializeTagStyles() {
    const allTopicTags = tagsWrapper.querySelectorAll('.topic-tag');
    allTopicTags.forEach(tag => {
        setTagStyle(tag, tag.classList.contains('active'));
    });
}

if (tagsWrapper) {
    tagsWrapper.addEventListener('click', (event) => {
        const clickedTag = event.target.closest('.topic-tag');
        if (!clickedTag) return;
        event.preventDefault();

        const allTopicTags = tagsWrapper.querySelectorAll('.topic-tag');
        const clickedTopic = clickedTag.dataset.topic;

        // Gestione stato active
        if (clickedTopic === 'all') {
            // Se clicco "All Topics" attivo solo quello e disattivo gli altri
            allTopicTags.forEach(tag => tag.classList.remove('active'));
            clickedTag.classList.add('active');
        } else {
            // Se clicco un filtro specifico toggle active
            clickedTag.classList.toggle('active');
            // Se almeno uno diverso da "all" √® attivo, disattiva "all"
            const anyActiveOther = Array.from(allTopicTags).some(tag => tag.dataset.topic !== 'all' && tag.classList.contains('active'));
            if (anyActiveOther) {
                document.querySelector('.topic-tag[data-topic="all"]').classList.remove('active');
            } else {
                // Se nessun filtro specifico √® attivo, attiva "all"
                document.querySelector('.topic-tag[data-topic="all"]').classList.add('active');
            }
        }

        // Aggiorna lo stile dei tag
        initializeTagStyles();

        // Calcola i filtri attivi
        const activeFilters = Array.from(allTopicTags)
            .filter(tag => tag.classList.contains('active'))
            .map(tag => tag.dataset.topic.toLowerCase());

        console.log('Filtri attivi:', activeFilters);

        const allCards = document.querySelectorAll('.question-card');

        // Mostra/nascondi card in base ai filtri
        allCards.forEach(card => {
            const themeSpan = card.querySelector('.theme-span');
            if (!themeSpan) return;
            const theme = themeSpan.dataset.theme.toLowerCase();

            if (activeFilters.includes('all') || activeFilters.includes(theme)) {
                card.classList.remove('hidden');
            } else {
                card.classList.add('hidden');
            }
        });
    });

    // Inizializza gli stili al caricamento
    initializeTagStyles();
}

        

            
            
            // --- Logica per lo scroll infinito ---

            function updateScrollState() {
                const totalWidth = Array.from(tagsWrapper.children).reduce((acc, child) => acc + child.offsetWidth + 8, 0); // 8 per lo space-x-2
                const containerWidth = scrollArea.offsetWidth;
                
                canScroll = totalWidth > containerWidth;

                if (canScroll) {
                    scrollLeftBtn.classList.remove('hidden');
                    scrollRightBtn.classList.remove('hidden');
                } else {
                    scrollLeftBtn.classList.add('hidden');
                    scrollRightBtn.classList.add('hidden');
                }
            }

            const animationDuration = 300; // Durata animazione in ms

            function scrollRight() {
                if (isAnimating || !canScroll) return;
                isAnimating = true;

                const firstTag = tagsWrapper.children[0];
                const scrollAmount = firstTag.offsetWidth + 8;

                tagsWrapper.style.transform = `translateX(-${scrollAmount}px)`;

                setTimeout(() => {
                    tagsWrapper.appendChild(firstTag);
                    tagsWrapper.classList.remove('transition-transform', 'duration-300', 'ease-in-out');
                    tagsWrapper.style.transform = '';
                    void tagsWrapper.offsetWidth; 
                    tagsWrapper.classList.add('transition-transform', 'duration-300', 'ease-in-out');
                    isAnimating = false;
                }, animationDuration);
            }

            function scrollLeft() {
                if (isAnimating || !canScroll) return;
                isAnimating = true;

                const lastTag = tagsWrapper.children[tagsWrapper.children.length - 1];
                const scrollAmount = lastTag.offsetWidth + 8;

                tagsWrapper.classList.remove('transition-transform', 'duration-300', 'ease-in-out');
                tagsWrapper.insertBefore(lastTag, tagsWrapper.children[0]);
                tagsWrapper.style.transform = `translateX(-${scrollAmount}px)`;
                
                void tagsWrapper.offsetWidth;
                
                tagsWrapper.classList.add('transition-transform', 'duration-300', 'ease-in-out');
                tagsWrapper.style.transform = '';

                setTimeout(() => {
                    isAnimating = false;
                }, animationDuration);
            }

            // --- GESTIONE OTTIMIZZATA DELLO SCROLL MOUSE ---
            if (scrollArea) {
                let wheelTimeout;
                scrollArea.addEventListener('wheel', (event) => {
                    if (!canScroll) return;
                    event.preventDefault();

                    // Se c'√® gi√† un timeout in corso, non fare nulla.
                    if (isAnimating) return;

                    const scrollDirection = Math.sign(event.deltaX !== 0 ? event.deltaX : event.deltaY);

                    if (scrollDirection > 0) {
                        scrollRight();
                    } else if (scrollDirection < 0) {
                        scrollLeft();
                    }
                }, { passive: false });
            }
            
            // Inizializzazione e listener
            if (tagsWrapper) {
                initializeTagStyles();
                updateScrollState();
                
                scrollRightBtn.addEventListener('click', scrollRight);
                scrollLeftBtn.addEventListener('click', scrollLeft);
                window.addEventListener('resize', updateScrollState);
            }
            
        });
        // Dropdown toggle functions
        const sortButton = document.getElementById("sortButton");
        const sortMenu = document.getElementById("sortMenu");
        const sortLabel = document.getElementById("sortLabel");


        // Toggle dropdowns
        sortButton.addEventListener("click", () => {
            sortMenu.classList.toggle("hidden");
            statusMenu.classList.add("hidden"); // Chiude l'altro menu
        });


        // Seleziona valore e chiudi menu per Ordinamento
        sortMenu.querySelectorAll("button").forEach(btn => {
            btn.addEventListener("click", () => {
                sortLabel.textContent = btn.innerHTML;
                sortMenu.classList.add("hidden");
                console.log("Ordinamento selezionato:", btn.dataset.value);
            });
        });


        // Chiudi dropdown se clicchi fuori
        window.addEventListener("click", (e) => {
            if (!sortButton.contains(e.target) && !sortMenu.contains(e.target)) {
                sortMenu.classList.add("hidden");
            }

        });
        //// ================ per copiare link del pulsante condividi ================ /////////
        const copyButtons = document.querySelectorAll('.copy-link-btn');

        copyButtons.forEach(button => {
            button.addEventListener('click', () => {
                const pageUrl = window.location.href;
                navigator.clipboard.writeText(pageUrl)
                    .then(() => {
                        
                        alert('Link copiato negli appunti!');
                    })
                    .catch(err => {
                        console.error('Errore nel copiare il link:', err);
                    });
            });
        });



        // Prendi tutte le card
const allCards = Array.from(document.querySelectorAll('.question-card'));

function sortCards(criteria) {
    let sortedCards = [...allCards];

    switch(criteria) {
        case 'most-recent':
            // data-date in ordine decrescente (pi√π recente prima)
            sortedCards.sort((a, b) => new Date(b.dataset.date) - new Date(a.dataset.date));
            break;
        case 'most-voted':
            // data-votes ordine decrescente
            sortedCards.sort((a, b) => parseInt(b.dataset.votes) - parseInt(a.dataset.votes));
            break;
        case 'most-answered':
            // data-answers ordine decrescente
            sortedCards.sort((a, b) => parseInt(b.dataset.answers) - parseInt(a.dataset.answers));
            break;
        case 'unanswered':
            // data-answered ordine crescente (non risposto o meno recente prima)
            sortedCards.sort((a, b) => {
                const dateA = a.getAttribute('data-answered');
                const dateB = b.getAttribute('data-answered');

                if (!dateA && dateB) return -1; // a non risposto, va prima
                if (dateA && !dateB) return 1;  // b non risposto, a dopo
                if (!dateA && !dateB) return 0;

                return new Date(dateA) - new Date(dateB); // ordine crescente
            });
            break;
        default:
            break;
    }

    // Rimuovi tutte le card dal container
    const container = document.getElementById('questions-container');
    sortedCards.forEach(card => container.appendChild(card));
}

// Listener per bottone ordinamento
sortMenu.querySelectorAll("button").forEach(btn => {
    btn.addEventListener("click", () => {
        const criterion = btn.dataset.value;
        sortLabel.textContent = btn.innerHTML;
        sortMenu.classList.add("hidden");
        
        sortCards(criterion);  // <-- Chiama la funzione per ordinare le card

        console.log("Ordinamento applicato:", criterion);
    });
});

document.addEventListener('DOMContentLoaded', () => {
    sortCards('most-recent');
});



const statusButton = document.getElementById("statusButton");
const statusMenu = document.getElementById("statusMenu");
const statusLabel = document.getElementById("statusLabel");
const cards = document.querySelectorAll(".card"); // assicurati che tutte le card abbiano la classe .card

statusButton.addEventListener("click", () => {
  statusMenu.classList.toggle("hidden");
});

statusMenu.querySelectorAll("button").forEach(btn => {
  btn.addEventListener("click", () => {
    const selectedStatus = btn.dataset.value;
    statusLabel.textContent = btn.innerText;
    statusMenu.classList.add("hidden");

    filterCardsByStatus(selectedStatus);
  });
});

function filterCardsByStatus(status) {
  cards.forEach(card => {
    const cardStatus = card.dataset.status;

    if (status === "all") {
      card.classList.remove("hidden");
    } else {
      if (status === "active" && cardStatus === "active") {
        card.classList.remove("hidden");
      } else if (status === "ranking" && cardStatus === "ranking") {
        card.classList.remove("hidden");
      } else if (status === "closed" && cardStatus === "closed") {
        card.classList.remove("hidden");
      } else {
        card.classList.add("hidden");
      }
    }
  });
}
document.addEventListener("DOMContentLoaded", () => {
  const questionObjDiv = document.getElementById("question-obj");
  const questionId = questionObjDiv ? questionObjDiv.dataset.questionId : null;

  if (questionId) {
    const card = document.querySelector(`.card[data-question-id='${questionId}']`);
    if (card) {
      // Scorri fino alla card
      card.scrollIntoView({ behavior: "smooth", block: "center" });

      // Se la tua card si apre cliccando su se stessa:
      // trova il trigger <p> e cliccalo per aprire il pannello
      const trigger = card.querySelector('p[data-action]');
      if (trigger) {
        trigger.click();
      }

    }
  }
});

    </script>

</body>
</html>